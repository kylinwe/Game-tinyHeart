var waveObj=function(){this.x=[];this.y=[];this.alive=[];this.r=[]};waveObj.prototype.num=10;waveObj.prototype.init=function(){for(var i=0;i<this.num;i++){this.alive[i]=false;this.r[i]=0}};waveObj.prototype.draw=function(){ctx1.save();ctx1.lineWidth=2;ctx1.shadowBlur=10;ctx1.shadowColor="white";for(var i=0;i<this.num;i++){if(this.alive[i]){this.r[i]+=deltaTime*0.05;if(this.r[i]>40){this.alive[i]=false;break}var alpha=1-this.r[i]/40;ctx1.beginPath();ctx1.arc(this.x[i],this.y[i],this.r[i],0,Math.PI*2);ctx1.closePath();ctx1.strokeStyle="rgba(255,255,255,"+alpha+")";ctx1.stroke()}}ctx1.restore()};waveObj.prototype.born=function(x,y){for(var i=0;i<this.num;i++){if(!this.alive[i]){this.alive[i]=true;this.r[i]=10;this.x[i]=x;this.y[i]=y;return}}};
var momObj=function(){this.x;this.y;this.angle;this.momTailTimer=0;this.momTailCount=0;this.momEyeTimer=0;this.momEyeCount=0;this.momEyeInterval=1000;this.momBodyCount=0};momObj.prototype.init=function(){this.x=canWidth*0.5;this.y=canHeight*0.5;this.angle=0};momObj.prototype.draw=function(){this.x=lerpDistance(mx,this.x,0.92);this.y=lerpDistance(my,this.y,0.92);var deltaY=my-this.y;var deltaX=mx-this.x;var beta=Math.atan2(deltaY,deltaX)+Math.PI;this.angle=lerpAngle(beta,this.angle,0.6);this.momTailTimer+=deltaTime;if(this.momTailTimer>50){this.momTailCount=(this.momTailCount+1)%8;this.momTailTimer%=50}this.momEyeTimer+=deltaTime;if(this.momEyeTimer>this.momEyeInterval){this.momEyeCount=(this.momEyeCount+1)%2;this.momEyeTimer%=this.momEyeInterval;if(this.momEyeCount==0){this.momEyeInterval=Math.random()*1500+2000}else{this.momEyeInterval=200}}ctx1.save();ctx1.translate(this.x,this.y);ctx1.rotate(this.angle);var momTailCount=this.momTailCount;ctx1.drawImage(momTail[momTailCount],-momTail[momTailCount].width*0.5+30,-momTail[momTailCount].height*0.5);var momBodyCount=this.momBodyCount;if(data.dou==1){ctx1.drawImage(momBodyOrange[momBodyCount],-momBodyOrange[momBodyCount].width*0.5,-momBodyOrange[momBodyCount].height*0.5)}else{ctx1.drawImage(momBodyBlue[momBodyCount],-momBodyBlue[momBodyCount].width*0.5,-momBodyBlue[momBodyCount].height*0.5)}var momEyeCount=this.momEyeCount;ctx1.drawImage(momEye[momEyeCount],-momEye[momEyeCount].width*0.5,-momEye[momEyeCount].height*0.5);ctx1.restore()};
var can1;var can2;var ctx1;var ctx2;var lastTime;var deltaTime;var bgPic=new Image();var ane;var fruit;var mom;var mx;var my;var baby;var canWidth;var canHeight;var babyTail=[];var babyEye=[];var babyBody=[];var momTail=[];var momEye=[];var momBodyBlue=[];var momBodyOrange=[];var data;var wave;var halo;var dust;var dustPic=[];document.body.onload=game;function game(){init();lastTime=Date.now();deltaTime=0;gameloop()}function init(){can1=document.getElementById("canvas1");ctx1=can1.getContext("2d");can2=document.getElementById("canvas2");ctx2=can2.getContext("2d");can1.addEventListener("mousemove",onMouseMove,false);bgPic.src="./src/background.jpg";canWidth=can1.width;canHeight=can1.height;ane=new aneObj();ane.init();fruit=new fruitObj();fruit.init();mom=new momObj();mom.init();baby=new babyObj();baby.init();mx=canWidth*0.5;my=canHeight*0.5;for(var i=0;i<8;i++){babyTail[i]=new Image();babyTail[i].src="./src/babyTail"+i+".png"}for(var i=0;i<2;i++){babyEye[i]=new Image();babyEye[i].src="./src/babyEye"+i+".png"}for(var i=0;i<20;i++){babyBody[i]=new Image();babyBody[i].src="./src/babyFade"+i+".png"}for(var i=0;i<8;i++){momTail[i]=new Image();momTail[i].src="./src/bigTail"+i+".png"}for(var i=0;i<2;i++){momEye[i]=new Image();momEye[i].src="./src/bigEye"+i+".png"}data=new dataObj();for(var i=0;i<8;i++){momBodyOrange[i]=new Image();momBodyBlue[i]=new Image();momBodyOrange[i].src="./src/bigSwim"+i+".png";momBodyBlue[i].src="./src/bigSwimBlue"+i+".png"}ctx1.font="30px Verdana";ctx1.textAlign="center";wave=new waveObj();wave.init();halo=new haloObj();halo.init();for(var i=0;i<7;i++){dustPic[i]=new Image();dustPic[i].src="./src/dust"+i+".png"}dust=new dustObj();dust.init()}function gameloop(){requestAnimFrame(gameloop);var now=Date.now();deltaTime=now-lastTime;lastTime=now;if(deltaTime>40){deltaTime=40}drawBackground();ane.draw();fruit.draw();fruitMonitor();ctx1.clearRect(0,0,canWidth,canHeight);mom.draw();baby.draw();momFruitsCollision();momBabyCollision();data.draw();wave.draw();
halo.draw();dust.draw()}function onMouseMove(e){if(!data.gameOver){if(e.offSetX||e.layerX){mx=e.offSetX==undefined?e.layerX:e.offSetX;my=e.offSetY==undefined?e.layerY:e.offSetY}}};
var dustObj=function(){this.x=[];this.y=[];this.amp=[];this.No=[];this.angle=0};dustObj.prototype.num=40;dustObj.prototype.init=function(){for(var i=0;i<this.num;i++){this.x[i]=Math.random()*canWidth;this.y[i]=Math.random()*canHeight-150*Math.random();this.amp[i]=20+Math.random()*25;this.No[i]=Math.floor(Math.random()*7)}};dustObj.prototype.draw=function(){this.angle+=deltaTime*0.0008;var l=Math.sin(this.angle);for(var i=0;i<this.num;i++){var no=this.No[i];ctx1.drawImage(dustPic[no],this.x[i]+l*this.amp[i],this.y[i])}};window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback,element){return window.setTimeout(callback,1000/60)}})();function calLength2(x1,y1,x2,y2){return Math.pow(x1-x2,2)+Math.pow(y1-y2,2)}function randomColor(){var col=[0,1,2];col[0]=Math.random()*100+155;col[0]=col[0].toFixed();col[1]=Math.random()*100+155;col[1]=col[1].toFixed();col[2]=Math.random()*100+155;col[2]=col[2].toFixed();var num=Math.floor(Math.random()*3);col[num]=0;return"rgba("+col[0]+","+col[1]+","+col[2]+","}function lerpAngle(a,b,t){var d=b-a;if(d>Math.PI){d=d-2*Math.PI}if(d<-Math.PI){d=d+2*Math.PI}return a+d*t}function lerpDistance(aim,cur,ratio){var delta=cur-aim;return aim+delta*ratio}function inOboundary(arrX,arrY,l,r,t,b){return arrX>l&&arrX<r&&arrY>t&&arrY<b}function rgbColor(r,g,b){r=Math.round(r*256);g=Math.round(g*256);b=Math.round(b*256);return"rgba("+r+","+g+","+b+",1)"}function rgbNum(r,g,b){r=Math.round(r*256);g=Math.round(g*256);b=Math.round(b*256);return"rgba("+r+","+g+","+b}function rnd(m){var n=m||1;return Math.random()*n}function rateRandom(m,n){var sum=0;for(var i=1;i<(n-m);i++){sum+=i}var ran=Math.random()*sum;for(var i=1;i<(n-m);i++){ran-=i;if(ran<0){return i-1+m}}}function distance(x1,y1,x2,y2,l){var x=Math.abs(x1-x2);var y=Math.abs(y1-y2);if(x<l&&y<l){return true}return false}function AABBbox(object1,w1,h1,object2,w2,h2,overlap){A1=object1.x+overlap;
B1=object1.x+w1-overlap;C1=object1.y+overlap;D1=object1.y+h1-overlap;A2=object2.x+overlap;B2=object2.x+w2-overlap;C2=object2.y+overlap;D2=object2.y+h2-overlap;if(A1>B2||B1<A2||C1>D2||D1<C2){return false}else{return true}}function dis2(x,y,x0,y0){var dx=x-x0;var dy=y-y0;return dx*dx+dy*dy}function rndi2(m,n){var a=Math.random()*(n-m)+m;return Math.floor(a)}var dataObj=function(){this.fruitNum=0;this.dou=1;this.score=0;this.gameOver=false;this.alpha=0};dataObj.prototype.reset=function(){this.fruitNum=0;this.dou=1};dataObj.prototype.draw=function(){var w=can1.width;var h=can1.height;ctx1.save();ctx1.shadowBlur=10;ctx1.shadowColor="white";ctx1.fillStyle="white";ctx1.fillText("SCORE: "+this.score,w*0.5,h-20);if(this.gameOver){this.alpha+=deltaTime*0.0003;if(this.alpha>1){this.alpha=1}ctx1.fillStyle="rgba(255,255,255,"+this.alpha+")";ctx1.fillText("GAMEOVER",w*0.5,h*0.5)}ctx1.restore()};dataObj.prototype.addScore=function(){this.score+=this.fruitNum*100*this.dou;this.fruitNum=0;this.dou=1};function momFruitsCollision(){if(!data.gameOver){for(var i=0;i<fruit.num;i++){if(fruit.alive[i]){var l=calLength2(fruit.x[i],fruit.y[i],mom.x,mom.y);if(l<900){fruit.dead(i);data.fruitNum++;mom.momBodyCount++;if(mom.momBodyCount>7){mom.momBodyCount=7}if(fruit.fruitType[i]=="blue"){data.dou=2}wave.born(fruit.x[i],fruit.y[i])}}}}}function momBabyCollision(){if(data.fruitNum>0&&!data.gameOver){var l=calLength2(mom.x,mom.y,baby.x,baby.y);if(l<900){baby.babyBodyCount=0;mom.momBodyCount=0;data.addScore();halo.born(baby.x,baby.y)}}}function drawBackground(){ctx2.drawImage(bgPic,0,0,canWidth,canHeight)}var aneObj=function(){this.rootx=[];this.headx=[];this.heady=[];this.angle=0;this.amp=[]};aneObj.prototype.num=50;aneObj.prototype.init=function(){for(var i=0;i<this.num;i++){this.rootx[i]=i*16+Math.random()*20;this.headx[i]=this.rootx[i];this.heady[i]=canHeight-250+Math.random()*50;this.amp[i]=Math.random()*50+55}};aneObj.prototype.draw=function(){this.angle+=deltaTime*0.0008;var l=Math.sin(this.angle);
ctx2.save();ctx2.globalAlpha=0.4;ctx2.lineWidth=20;ctx2.shadowBlur=20;ctx2.shadowColor="rgba(138,43,226,0.4)";ctx2.lineCap="round";ctx2.strokeStyle="#3b154b";for(var i=0;i<this.num;i++){ctx2.beginPath();ctx2.moveTo(this.rootx[i],canHeight);this.headx[i]=this.rootx[i]+l*this.amp[i];ctx2.quadraticCurveTo(this.rootx[i],canHeight-150,this.headx[i],this.heady[i]);ctx2.stroke()}ctx2.restore()};var babyObj=function(){this.x;this.y;this.angle;this.babyTailTimer=0;this.babyTailCount=0;this.babyEyeTimer=0;this.babyEyeCount=0;this.babyEyeInterval=1000;this.babyBodyTimer=0;this.babyBodyCount=0};babyObj.prototype.init=function(){this.x=canWidth*0.5-50;this.y=canHeight*0.5+50;this.angle=0};babyObj.prototype.draw=function(){this.x=lerpDistance(mom.x-50,this.x,0.98);this.y=lerpDistance(mom.y+50,this.y,0.98);var deltaY=mom.y-this.y;var deltaX=mom.x-this.x;var beta=Math.atan2(deltaY,deltaX)+Math.PI;this.angle=lerpAngle(beta,this.angle,0.6);this.babyTailTimer+=deltaTime;if(this.babyTailTimer>50){this.babyTailCount=(this.babyTailCount+1)%8;this.babyTailTimer%=50}this.babyEyeTimer+=deltaTime;if(this.babyEyeTimer>this.babyEyeInterval){this.babyEyeCount=(this.babyEyeCount+1)%2;this.babyEyeTimer%=this.babyEyeInterval;if(this.babyEyeCount==0){this.babyEyeInterval=Math.random()*1500+2000}else{this.babyEyeInterval=200}}this.babyBodyTimer+=deltaTime;if(this.babyBodyTimer>400){this.babyBodyCount=this.babyBodyCount+1;this.babyBodyTimer%=400;if(this.babyBodyCount>19){this.babyBodyCount=19;data.gameOver=true}}ctx1.save();ctx1.translate(this.x,this.y);ctx1.rotate(this.angle);var babyTailCount=this.babyTailCount;ctx1.drawImage(babyTail[babyTailCount],-babyTail[babyTailCount].width*0.5+23,-babyTail[babyTailCount].height*0.5);var babyBodyCount=this.babyBodyCount;ctx1.drawImage(babyBody[babyBodyCount],-babyBody[babyBodyCount].width*0.5,-babyBody[babyBodyCount].height*0.5);var babyEyeCount=this.babyEyeCount;ctx1.drawImage(babyEye[babyEyeCount],-babyEye[babyEyeCount].width*0.5,-babyEye[babyEyeCount].height*0.5);
ctx1.restore()};var fruitObj=function(){this.alive=[];this.x=[];this.y=[];this.l=[];this.aneNo=[];this.speed=[];this.fruitType=[];this.orange=new Image();this.blue=new Image()};fruitObj.prototype.num=30;fruitObj.prototype.init=function(){for(var i=0;i<this.num;i++){this.alive[i]=false;this.x[i]=0;this.y[i]=0;this.l[i]=0;this.speed[i]=Math.random()*0.017+0.003;this.fruitType[i]=""}this.orange.src="./src/fruit.png";this.blue.src="./src/blue.png"};fruitObj.prototype.born=function(i){var aneID=Math.floor(Math.random()*ane.num);this.x[i]=ane.headx[aneID];this.y[i]=ane.heady[aneID];this.l[i]=0;this.alive[i]=true;var ran=Math.random();if(ran<0.2){this.fruitType[i]="blue"}else{this.fruitType[i]="orange"}};fruitObj.prototype.draw=function(){for(var i=0;i<this.num;i++){if(this.fruitType[i]=="blue"){var pic=this.blue}else{var pic=this.orange}if(this.alive[i]){if(this.l[i]<=14){this.l[i]+=this.speed[i]*deltaTime}else{this.y[i]-=this.speed[i]*7*deltaTime}ctx2.drawImage(pic,this.x[i]-this.l[i]*0.5,this.y[i]-this.l[i]*0.5,this.l[i],this.l[i]);if(this.y[i]<10){this.alive[i]=false}}}};fruitObj.prototype.dead=function(i){this.alive[i]=false};function fruitMonitor(){var num=0;for(var i=0;i<fruit.num;i++){if(fruit.alive[i]){num++}}if(num<15){sendFruit();return}}function sendFruit(){for(var i=0;i<fruit.num;i++){if(!fruit.alive[i]){fruit.born(i);return}}};
var haloObj=function(){this.x=[];this.y=[];this.alive=[];this.r=[]};haloObj.prototype.num=5;haloObj.prototype.init=function(){for(var i=0;i<this.num;i++){this.alive[i]=false;this.r[i]=0}};haloObj.prototype.draw=function(){ctx1.save();ctx1.lineWidth=2;ctx1.shadowBlur=10;ctx1.shadowColor="rgba(203,91,0)";for(var i=0;i<this.num;i++){if(this.alive[i]){this.r[i]+=deltaTime*0.05;if(this.r[i]>100){this.alive[i]=false;break}var alpha=1-this.r[i]/100;ctx1.beginPath();ctx1.arc(this.x[i],this.y[i],this.r[i],0,Math.PI*2);ctx1.closePath();ctx1.strokeStyle="rgba(203,91,0,"+alpha+")";ctx1.stroke()}}ctx1.restore()};haloObj.prototype.born=function(x,y){for(var i=0;i<this.num;i++){if(!this.alive[i]){this.alive[i]=true;this.r[i]=10;this.x[i]=x;this.y[i]=y}}};
